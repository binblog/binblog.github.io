	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>effective java - 方法 | binecy</title>
  <meta name="author" content="bin">
  
  <meta name="description" content="《Effective Java》读书笔记，关于方法系列。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="effective java - 方法"/>
  <meta property="og:site_name" content="binecy"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">binecy</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>effective java - 方法</h2>
					
					<div>
						<span class="post-time">2016-10-12 22:35:24</span>
					</div>	
					

					<div class="article-content">
						<p><a href="https://book.douban.com/subject/3360807/" target="_blank" rel="external">《Effective Java》</a>读书笔记，关于方法系列。<br><a id="more"></a></p>
<h2 id="检查参数有效性"><a href="#检查参数有效性" class="headerlink" title="检查参数有效性"></a>检查参数有效性</h2><p>应该在方法开头检查参数，如索引值必须大于0，对象引用不能为null（“应该在发生错误之后尽快检测错误”）</p>
<p>对于公有方法，要用Javadoc的@throws标签在文档中说明违反参数限制会抛出的异常。通常抛出IllegalArgumentException，IndexOutOfBoundException，NullPointerException异常。</p>
<p>如果因为无效参数值导致计算过程抛出的异常，与文档标明方法将抛出的异常不相符，应该使用异常转译。</p>
<p>对于未导出的方法，作为包的创建者，你可以控制这个方法将在哪些情况下被调用，因此你可以确保只将有效的参数值传递进来，所以，非公有方法应该使用断言（assertion）检查参数</p>
<p><strong>对于有些参数，方法本身没有用到，却被保存起来以后使用，检验这类参数的有效性尤其重要。</strong></p>
<p>如果有效检查非常昂贵或不切实际，可不用检查。如Collections.sort(List)不用提前检查每个元素是否能够相互比较，这正是sort方法应该做的事情。</p>
<!--more-->
<h2 id="必要时进行保护性拷贝"><a href="#必要时进行保护性拷贝" class="headerlink" title="必要时进行保护性拷贝"></a>必要时进行保护性拷贝</h2><p>考虑下面这个类是否为一个不可变类：</p>
<pre><code>public class Period {
    private final Date start;
    private final Date end;

    public Period(Date start, Date end) {
        if(start.compareTo(end) &gt; 0) {
            throw new IllegalArgumentException(start + &quot; after &quot; + end);
        }
        this.start = start;
        this.end = end;
     }

    public Date getStart() { return start;     }

    public Date getEnd() { return end;    }

}
</code></pre><p>这并不是一个不可变类，如：</p>
<pre><code>Date start = new Date();
Date end = new Date();
Period period = new Period(start, end);
end.setYear(78);
</code></pre><p>可以看到period的内部被破坏</p>
<p><strong>对于构造器的每个可变参数进行保护性拷贝是必要的</strong></p>
<pre><code>public Period(Date start, Date end) {
    if(start.compareTo(end) &gt; 0) {
        throw new IllegalArgumentException(start + &quot; after &quot; + end);
    }
    this.start = new Date(start.getTime());
    this.end = new Date(end.getTime());
}
</code></pre><p><strong>保护性拷贝在检查参数的有效性之前进行，并且有效性检查是针对拷贝之后的对象，而不是针对原始对象。</strong> 这样可以避免在“从检查参数开始，执行到拷贝参数之间的时间段”，其他线程修改参数</p>
<p>这里没有使用clone方法，因为Date非final类，不能保证子类clone方法一定返回类为java.util.Date的对象，子类可以返回恶意破坏的实例。<strong>对于参数类型可以被不信任方子类化的参数，不要使用clone方法进行保护性拷贝</strong></p>
<p>上面period仍然可以被改变：</p>
<pre><code>Period period = new Period(new Date(), new Date());
period.end.setYear(78);
</code></pre><p><strong>对返回可变域进行保护性拷贝</strong></p>
<pre><code>public Date getStart() { return new Date(start.getTime());     }
public Date getEnd() { return new Date(end.getTime());    }
</code></pre><p>访问方法进行保护性拷贝可以使用clone方法，因为确认Period内部实例为java.util.Date的对象</p>
<p>接受客户提供的对象，有必要考虑一下你的类是否容忍对象进入数据结构后发生变化，同样，返回内部可变组件到客户端之前也要考虑是否容忍对象改变。</p>
<h2 id="慎用重载"><a href="#慎用重载" class="headerlink" title="慎用重载"></a>慎用重载</h2><p>要调用哪个重载方法，是在编译时做出的决定。<br>避免胡乱使用重载机制，才能不会陷入到“对于任何一组实例的参数，哪个重载方法是适用的”的困扰中。<br><strong>安全而保守的策略是，永远不要导出两个具有相同参数数目的重载方法。如果方法使用可变参数，保守的策略是根本不要重载它。</strong><br><strong>但如果两个重载方法在同样的参数上被调用，它们执行相同的功能，重载就不会带来危害。可以让更具体化的重载方法把调用转发给更一般的重载方法。</strong></p>
<pre><code>public boolean contentEquals(StringBuffer sb) {
    return contentEquals((CharSequence)sb);
}
</code></pre><p><strong>自动装箱和泛型，会使谨慎重载显得更加重要了。</strong></p>
<p>下述代码无法正常删除list中的正数：</p>
<pre><code>Set&lt;Integer&gt; set = new TreeSet&lt;Integer&gt;();
List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;();

for(int i = -3; i &lt; 3; i++) {
    set.add(i);
    list.add(i);
}

for(int i = 0; i &lt; 3; i++) {
    set.remove(i);
    list.remove(i);
}
System.out.println(set + &quot; &quot; + list);
</code></pre><p>上述代码中输出结果为<br><code>[-3, -2, -1] [-2, 0, 2]</code><br>因为set只有remove(Object o)方法，而list重载了remove(Object o)和remove(int index)方法，这里调用到remove(int index)，即删除对应下标的元素。</p>
<pre><code>for(int i = 0; i &lt; 3; i++) {
    set.remove(i);
    list.remove((Integer)i);
}
</code></pre><p>上述代码才可以正常删除list中的正数。</p>
<h2 id="慎用可变参数"><a href="#慎用可变参数" class="headerlink" title="慎用可变参数"></a>慎用可变参数</h2><p>在定义参数数目不定的方法时，可变参数方法是一种很方便的方式，但是它们不应该被滥用，如果使用不恰当，会产生混乱的结果  </p>
<h2 id="返回零长度的数组或集合，而不是null"><a href="#返回零长度的数组或集合，而不是null" class="headerlink" title="返回零长度的数组或集合，而不是null"></a>返回零长度的数组或集合，而不是null</h2><h2 id="为所有导出的api编写文档注释"><a href="#为所有导出的api编写文档注释" class="headerlink" title="为所有导出的api编写文档注释"></a>为所有导出的api编写文档注释</h2><p><strong>在每个被导出的类，接口，构造器，方法和域声明之前增加一个文档注释</strong></p>
<p><strong>方法的文档注释应该简洁地描述它和客户端之间的约定。这个约定应该说明方法做了什么，而不是怎么做。</strong><br>文档还应该列举这个方法的所有前提条件和后置条件。前提条件是指为了使客户端能够调用这个方法，必须满足的条件。后置条件指调用成功后，哪些条件必须满足。</p>

					</div>
					
			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  
   <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="_posts/effective-java-method.md" data-title="effective java - 方法" data-url="https://binecy.coding.me/effective-java-method/"></div>
    <!-- 多说评论框 end -->
   <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'tanke773'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  


</div>
	</div>

	
		<div class="col-md-3">
			<div id="toc" ></div>
		</div>
	

</div>


		<footer>
			

<!--
<p>
  &copy; 2017 <a href="https://binecy.coding.me"> bin </a>
</p>
-->
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
